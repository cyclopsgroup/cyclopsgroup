<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:w="http://waterview.cyclopsgroup.com/ui" xmlns:j="jelly:core">
    <head>
        <w:JellyScript path="/waterview/DefaultHtmlHeaders.jelly" />
    </head>
    <body>
        <div align="center">
            <div id="bodyWrapper">
                <table width="100%" cellspacing="0" border="0" cellpadding="0">
                    <tr>
                        <td colspan="2" id="bannerPanel">
                            <w:JellyScript path="/waterview/DefaultHtmlBanner.jelly" />
                        </td>
                    </tr>
                    <tr>
                        <td width="25%" valign="top" id="leftPanel" rowspan="2">
                            <j:set var="navigationNode" value="${selectedNode}" />
                            <w:GetPanelViews var="views" panel="navigation">
                                <w:JellyView name="%waterview.view.systemnavigation"
                                    script="/waterview/sysview/DefaultNavigationNode.jelly" />
                                <w:View name="%tornado.navigation.myinfo">
                                    <j:choose>
                                        <j:when test="${currentUser.guest}">
                                            <p>%tornado.p.notlogin</p>
                                            <table border="0">
                                                <w:FormControl>
                                                    <w:Form name="login" method="post">
                                                        <input type="hidden" name="redirectto"
                                                            value="${data.params.getString('redirectto')}" />
                                                        <tr>
                                                            <td>%document.text.name</td>
                                                            <td>
                                                                <w:Field name="username" required="true" size="12" />
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>%document.text.password</td>
                                                            <td>
                                                                <w:Field name="password" password="true" required="true"
                                                                    size="12" />
                                                            </td>
                                                            <tr>
                                                                <td>%document.text.timeout</td>
                                                                <td>
                                                                    <w:Field name="timeout" type="int" title="Timeout"
                                                                        required="true" value="30" size="3" />
                                                                    %document.text.minute
                                                                </td>
                                                            </tr>
                                                            <td colspan="2">
                                                                <w:Submit
                                                                    action="${link.addAction('/tornado/UserLoginAction.jelly').setPage('/Index.jelly')}"
                                                                    forceValidation="true">
                                                                    <w:FormButton title="%document.text.login" />
                                                                </w:Submit>
                                                            </td>
                                                        </tr>
                                                    </w:Form>
                                                </w:FormControl>
                                            </table>
                                        </j:when>
                                        <j:otherwise>
                                            <p>%document.text.hello, ${currentUser.displayName}</p>
                                            <p>
                                                <a
                                                    href="${link.addAction('/tornado/UserLogoutAction').setPage('/Index.jelly')}">
                                                    %document.text.logout
                                                </a>
                                            </p>
                                        </j:otherwise>
                                    </j:choose>
                                </w:View>
                            </w:GetPanelViews>
                            <j:forEach var="view" items="${views}">
                                <w:WindowControl title="${view.name}" shadow="2" border="1">
                                    <w:DisplayView view="${view}" />
                                </w:WindowControl>
                            </j:forEach>
                        </td>
                        <td width="75%" class="bannerPanelBelt">
                            <table border="0">
                                <tr>
                                    <td>
                                        <img src="${themeBase}/16x16/screen.png" width="16" height="16"
                                            alt="Your position" />
                                    </td>
                                    <td>
                                        <j:forEach var="parent" items="${currentNavigatorNode.parentNodes}">
                                            <a href="${link.setPage(parent.page)}">${parent.title}</a>
                                            &gt;&gt;
                                        </j:forEach>
                                        <b>${currentNavigatorNode.title}</b>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top" id="bodyPanel">
                            <j:set var="messages" value="${data.messages}" />
                            <j:if test="${size(messages) gt 0}">
                                <table border="0">
                                    <j:forEach var="msg" items="${messages}">
                                        <tr>
                                            <td>
                                                <img src="${themeBase}/16x16/info.png" width="16" height="16"
                                                    alt="Message" />
                                            </td>
                                            <td class="waterviewMessage">${msg}</td>
                                        </tr>
                                    </j:forEach>
                                </table>
                            </j:if>
                            <j:set var="mainTitle" value="${navigator.getNodeByPage(data.page.fullPath).title}" />
                            <w:GetPanelViews var="views" panel="body">
                                <w:SimpleView path="/${data.page.packageAlias}/view${data.page.path}"
                                    title="${mainTitle}" />
                            </w:GetPanelViews>
                            <j:forEach var="view" items="${views}">
                                <w:WindowControl title="${view.name}" maximizable="true" editable="true" border="0">
                                    <w:DisplayView view="${view}" />
                                </w:WindowControl>
                            </j:forEach>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" id="footerPanel">
                            <w:JellyScript path="/waterview/DefaultHtmlFooter.jelly" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </body>
</html>
